# This workflow will upload a Python Package using Twine when a release is created
# For more information see: https://help.github.com/en/actions/language-and-framework-guides/using-python-with-github-actions#publishing-to-package-registries

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Docs Build

on:
  push:
    branches:
      - main


permissions:
  id-token: write
  contents: read
  pages: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  docs:


    runs-on: ubuntu-latest

    environment:
      url: ${{ steps.deployment.outputs.page_url }}
      name: github-pages

    steps:
    - uses: actions/checkout@v5

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version-file: ".python-version"

    - uses: chalbersma/plantuml-install-action@main
      with:
        install_java: "yes"

    - name: Install uv
      uses: astral-sh/setup-uv@v6
      with:
        enable-cache: true

    - name: Install the Project
      run: uv sync --locked --all-extras --dev

    - name: Build Docs
      run: |
        uv run coverage run ./run_tests.py
        uv run coverage html -d docs/_static/coverage
    
    - name: Build HTML (Deliver to ./ci/dist)
      run:  uv run --directory docs --group docs make html

    - name: Configure Pages
      uses: actions/configure-pages@v5

    - name: Upload artifact
      id: upload-artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: "./docs/_build/html/"

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
